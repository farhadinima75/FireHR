---

title: Data


keywords: fastai
sidebar: home_sidebar

summary: "This module contains functions to download and preprocess the data"
description: "This module contains functions to download and preprocess the data"
nb_path: "nbs/01_data.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_data.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Region" class="doc_header"><code>class</code> <code>Region</code><a href="https://github.com/mnpinto/banet/tree/master/banet/geo.py#L27" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Region</code>(<strong><code>name</code></strong>:<code>str</code>, <strong><code>bbox</code></strong>:<code>list</code>, <strong><code>pixel_size</code></strong>:<code>float</code>, <strong><code>epsg</code></strong>:<code>int</code>=<em><code>4326</code></em>)</p>
</blockquote>
<p>Defines a geographical region with a name, a bounding box and the pixel size</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="RegionST" class="doc_header"><code>class</code> <code>RegionST</code><a href="https://github.com/mnpinto/FireHR/tree/master/FireHR/data.py#L28" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>RegionST</code>(<strong><code>name</code></strong>:<code>str</code>, <strong><code>bbox</code></strong>:<code>list</code>, <strong><code>pixel_size</code></strong>:<code>float</code>, <strong><code>time_start</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>time_end</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>time_freq</code></strong>:<code>str</code>=<em><code>'D'</code></em>, <strong><code>time_margin</code></strong>:<code>int</code>=<em><code>0</code></em>) :: <a href="/FireHR/data.html#Region"><code>Region</code></a></p>
</blockquote>
<p>Defines a region in space and time with a name, a bounding box and the pixel size.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="extract_region" class="doc_header"><code>extract_region</code><a href="https://github.com/mnpinto/FireHR/tree/master/FireHR/data.py#L59" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>extract_region</code>(<strong><code>df_row</code></strong>)</p>
</blockquote>
<p>Create Region object from a row of the metadata dataframe.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="coords2bbox" class="doc_header"><code>coords2bbox</code><a href="https://github.com/mnpinto/FireHR/tree/master/FireHR/data.py#L69" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>coords2bbox</code>(<strong><code>lon</code></strong>, <strong><code>lat</code></strong>, <strong><code>pixel_size</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_region" class="doc_header"><code>split_region</code><a href="https://github.com/mnpinto/FireHR/tree/master/FireHR/data.py#L72" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_region</code>(<strong><code>region</code></strong>:<a href="/FireHR/data.html#RegionST"><code>RegionST</code></a>, <strong><code>size</code></strong>:<code>int</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="merge_tifs" class="doc_header"><code>merge_tifs</code><a href="https://github.com/mnpinto/FireHR/tree/master/FireHR/data.py#L95" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>merge_tifs</code>(<strong><code>files</code></strong>:<code>list</code>, <strong><code>fname</code></strong>:<code>str</code>, <strong><code>delete</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="filter_region" class="doc_header"><code>filter_region</code><a href="https://github.com/mnpinto/FireHR/tree/master/FireHR/data.py#L109" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>filter_region</code>(<strong><code>image_collection</code></strong>:<code>ImageCollection</code>, <strong><code>region</code></strong>:<a href="/FireHR/data.html#RegionST"><code>RegionST</code></a>, <strong><code>times</code></strong>:<code>tuple</code>, <strong><code>bands</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="filter_cloudy" class="doc_header"><code>filter_cloudy</code><a href="https://github.com/mnpinto/FireHR/tree/master/FireHR/data.py#L117" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>filter_cloudy</code>(<strong><code>image_collection</code></strong>:<code>ImageCollection</code>, <strong><code>max_cloud_fraction</code></strong>=<em><code>0.2</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="n_least_cloudy" class="doc_header"><code>n_least_cloudy</code><a href="https://github.com/mnpinto/FireHR/tree/master/FireHR/data.py#L121" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>n_least_cloudy</code>(<strong><code>image_collection</code></strong>:<code>ImageCollection</code>, <strong><code>n</code></strong>=<em><code>5</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="download_data" class="doc_header"><code>download_data</code><a href="https://github.com/mnpinto/FireHR/tree/master/FireHR/data.py#L131" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>download_data</code>(<strong><code>R</code></strong>:<a href="/FireHR/data.html#RegionST"><code>RegionST</code></a>, <strong><code>times</code></strong>, <strong><code>products</code></strong>, <strong><code>bands</code></strong>, <strong><code>path_save</code></strong>, <strong><code>scale</code></strong>=<em><code>10</code></em>, <strong><code>max_cloud_fraction</code></strong>=<em><code>None</code></em>, <strong><code>use_least_cloudy</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="download_data_ts" class="doc_header"><code>download_data_ts</code><a href="https://github.com/mnpinto/FireHR/tree/master/FireHR/data.py#L235" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>download_data_ts</code>(<strong><code>R</code></strong>:<a href="/FireHR/data.html#RegionST"><code>RegionST</code></a>, <strong><code>products</code></strong>, <strong><code>bands</code></strong>, <strong><code>path_save</code></strong>, <strong><code>scale</code></strong>=<em><code>10</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Download median composite for any region example:</p>
<div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="n">RegionST</span><span class="p">(</span><span class="s1">&#39;test_region10&#39;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">8.0</span><span class="p">,</span><span class="mf">39.95</span><span class="p">,</span><span class="o">-</span><span class="mf">7.9</span><span class="p">,</span><span class="mf">40.05</span><span class="p">],</span> <span class="mf">0.001</span><span class="p">,</span> 
             <span class="n">time_start</span><span class="o">=</span><span class="s1">&#39;2020-07-01&#39;</span><span class="p">,</span> <span class="n">time_end</span><span class="o">=</span><span class="s1">&#39;2020-07-15&#39;</span><span class="p">)</span>
<span class="n">R</span><span class="o">.</span><span class="n">time_margin</span><span class="o">=</span><span class="mi">1</span>
<span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;COPERNICUS/S2&quot;</span><span class="p">]</span>
<span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B4&#39;</span><span class="p">,</span> <span class="s1">&#39;B8&#39;</span><span class="p">,</span> <span class="s1">&#39;B12&#39;</span><span class="p">]</span>
<span class="n">path</span>  <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;temp&#39;</span><span class="p">)</span>
<span class="n">before</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">120</span><span class="p">),</span> <span class="n">R</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">after</span>  <span class="o">=</span> <span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">R</span><span class="o">.</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">120</span><span class="p">))</span>
<span class="k">for</span> <span class="n">mode</span><span class="p">,</span> <span class="n">time_window</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;before&#39;</span><span class="p">,</span> <span class="s1">&#39;after&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">]):</span>
    <span class="n">path_save</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="n">R</span><span class="o">.</span><span class="n">name</span><span class="o">/</span><span class="n">mode</span>
    <span class="n">download_data</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">time_window</span><span class="p">,</span> <span class="n">products</span><span class="p">,</span> <span class="n">bands</span><span class="p">,</span> <span class="n">path_save</span><span class="p">,</span> 
                  <span class="n">use_least_cloudy</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Download median composite for any region example:</p>
<div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="n">RegionST</span><span class="p">(</span><span class="s1">&#39;test_region&#39;</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">8.0</span><span class="p">,</span><span class="mf">39.95</span><span class="p">,</span><span class="o">-</span><span class="mf">7.9</span><span class="p">,</span><span class="mf">40.05</span><span class="p">],</span> <span class="mf">0.001</span><span class="p">,</span> 
             <span class="n">time_start</span><span class="o">=</span><span class="s1">&#39;2020-07-01&#39;</span><span class="p">,</span> <span class="n">time_end</span><span class="o">=</span><span class="s1">&#39;2020-08-31&#39;</span><span class="p">)</span>
<span class="n">R</span><span class="o">.</span><span class="n">time_margin</span><span class="o">=</span><span class="mi">0</span>
<span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;COPERNICUS/S2&quot;</span><span class="p">]</span>
<span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;B4&#39;</span><span class="p">,</span> <span class="s1">&#39;B8&#39;</span><span class="p">,</span> <span class="s1">&#39;B12&#39;</span><span class="p">]</span>
<span class="n">path_save</span>  <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;temp&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">R</span><span class="o">.</span><span class="n">name</span>
<span class="n">download_data_ts</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">products</span><span class="p">,</span> <span class="n">bands</span><span class="p">,</span> <span class="n">path_save</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_event_data" class="doc_header"><code>get_event_data</code><a href="https://github.com/mnpinto/FireHR/tree/master/FireHR/data.py#L314" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_event_data</code>(<strong><code>event_id</code></strong>, <strong><code>year</code></strong>, <strong><code>coarse_mask_file</code></strong>, <strong><code>path</code></strong>=<em><code>Path('.')</code></em>, <strong><code>coarse_mask_doy_layer</code></strong>=<em><code>2</code></em>, <strong><code>products</code></strong>=<em><code>['COPERNICUS/S2']</code></em>, <strong><code>bands</code></strong>=<em><code>['B4', 'B8', 'B12']</code></em>, <strong><code>scale_factor</code></strong>=<em><code>0.0001</code></em>, <strong><code>composite_days</code></strong>=<em><code>[60, 60]</code></em>, <strong><code>max_cloud_fraction</code></strong>=<em><code>None</code></em>, <strong><code>use_least_cloudy</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">im</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span> <span class="o">=</span> <span class="n">get_event_data</span><span class="p">(</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="mi">2020</span><span class="p">,</span> <span class="s1">&#39;temp/banet100m.tif&#39;</span><span class="p">)</span>
<span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Event time_start: 2020-05-06 00:00:00
Event time_end: 2020-09-11 00:00:00
Downloading GEE median composite for: 2020-03-06 00:00:00 to 2020-05-05 00:00:00
Downloading GEE median composite for: 2020-09-12 00:00:00 to 2020-11-11 00:00:00
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((892, 881, 7),
 Affine(8.983152841195215e-05, 0.0, 6.579979793118671,
        0.0, -8.983152841195215e-05, 43.21507371008099),
 CRS.from_epsg(4326))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

